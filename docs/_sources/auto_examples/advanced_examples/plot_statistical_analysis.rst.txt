
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/advanced_examples/plot_statistical_analysis.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_advanced_examples_plot_statistical_analysis.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_advanced_examples_plot_statistical_analysis.py:

=======================
Statistical Analysis
=======================

The MOABB codebase comes with convenience plotting utilities and some
statistical testing. This tutorial focuses on what those exactly are and how
they can be used.

.. GENERATED FROM PYTHON SOURCE LINES 10-38

.. code-block:: default

    # Authors: Vinay Jayaram <vinayjayaram13@gmail.com>
    #
    # License: BSD (3-clause)
    # sphinx_gallery_thumbnail_number = -2

    import matplotlib.pyplot as plt
    from mne.decoding import CSP
    from pyriemann.estimation import Covariances
    from pyriemann.tangentspace import TangentSpace
    from sklearn.discriminant_analysis import LinearDiscriminantAnalysis as LDA
    from sklearn.linear_model import LogisticRegression
    from sklearn.pipeline import make_pipeline

    import moabb
    import moabb.analysis.plotting as moabb_plt
    from moabb.analysis.meta_analysis import (  # noqa: E501
        compute_dataset_statistics,
        find_significant_differences,
    )
    from moabb.datasets import BNCI2014001
    from moabb.evaluations import CrossSessionEvaluation
    from moabb.paradigms import LeftRightImagery


    moabb.set_log_level("info")

    print(__doc__)








.. GENERATED FROM PYTHON SOURCE LINES 39-57

Results Generation
---------------------

First we need to set up a paradigm, dataset list, and some pipelines to
test. This is explored more in the examples -- we choose a left vs right
imagery paradigm with a single bandpass. There is only one dataset here but
any number can be added without changing this workflow.

Create pipelines
----------------

Pipelines must be a dict of sklearn pipeline transformer.

The csp implementation from MNE is used. We selected 8 CSP components, as
usually done in the litterature.

The riemannian geometry pipeline consists in covariance estimation, tangent
space mapping and finaly a logistic regression for the classification.

.. GENERATED FROM PYTHON SOURCE LINES 57-68

.. code-block:: default


    pipelines = {}

    pipelines["CSP+LDA"] = make_pipeline(CSP(n_components=8), LDA())

    pipelines["RG+LR"] = make_pipeline(Covariances(), TangentSpace(), LogisticRegression())

    pipelines["CSP+LR"] = make_pipeline(CSP(n_components=8), LogisticRegression())

    pipelines["RG+LDA"] = make_pipeline(Covariances(), TangentSpace(), LDA())








.. GENERATED FROM PYTHON SOURCE LINES 69-79

Evaluation
----------

We define the paradigm (LeftRightImagery) and the dataset (BNCI2014001).
The evaluation will return a dataframe containing a single AUC score for
each subject / session of the dataset, and for each pipeline.

Results are saved into the database, so that if you add a new pipeline, it
will not run again the evaluation unless a parameter has changed. Results can
be overwritten if necessary.

.. GENERATED FROM PYTHON SOURCE LINES 79-91

.. code-block:: default


    paradigm = LeftRightImagery()
    dataset = BNCI2014001()
    dataset.subject_list = dataset.subject_list[:4]
    datasets = [dataset]
    overwrite = True  # set to False if we want to use cached results
    evaluation = CrossSessionEvaluation(
        paradigm=paradigm, datasets=datasets, suffix="stats", overwrite=overwrite
    )

    results = evaluation.process(pipelines)








.. GENERATED FROM PYTHON SOURCE LINES 92-98

MOABB plotting
----------------

Here we plot the results using some of the convenience methods within the
toolkit.  The score_plot visualizes all the data with one score per subject
for every dataset and pipeline.

.. GENERATED FROM PYTHON SOURCE LINES 98-102

.. code-block:: default


    fig = moabb_plt.score_plot(results)
    plt.show()




.. image:: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_001.png
    :alt: Scores per dataset and algorithm
    :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 103-107

For a comparison of two algorithms, there is the paired_plot, which plots
performance in one versus the performance in the other over all chosen
datasets. Note that there is only one score per subject, regardless of the
number of sessions.

.. GENERATED FROM PYTHON SOURCE LINES 107-111

.. code-block:: default


    fig = moabb_plt.paired_plot(results, "CSP+LDA", "RG+LDA")
    plt.show()




.. image:: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_002.png
    :alt: plot statistical analysis
    :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 112-120

Statistical testing and further plots
----------------------------------------

If the statistical significance of results is of interest, the method
compute_dataset_statistics allows one to show a meta-analysis style plot as
well. For an overview of how all algorithms perform in comparison with each
other, the method find_significant_differences and the summary_plot are
possible.

.. GENERATED FROM PYTHON SOURCE LINES 120-124

.. code-block:: default


    stats = compute_dataset_statistics(results)
    P, T = find_significant_differences(stats)








.. GENERATED FROM PYTHON SOURCE LINES 125-128

The meta-analysis style plot shows the standardized mean difference within
each tested dataset for the two algorithms in question, in addition to a
meta-effect and significances both per-dataset and overall.

.. GENERATED FROM PYTHON SOURCE LINES 128-131

.. code-block:: default

    fig = moabb_plt.meta_analysis_plot(stats, "CSP+LDA", "RG+LDA")
    plt.show()




.. image:: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_003.png
    :alt: < RG+LDA better                                                                              CSP+LDA better >, p-value
    :class: sphx-glr-single-img





.. GENERATED FROM PYTHON SOURCE LINES 132-135

The summary plot shows the effect and significance related to the hypothesis
that the algorithm on the y-axis significantly out-performed the algorithm on
the x-axis over all datasets

.. GENERATED FROM PYTHON SOURCE LINES 135-137

.. code-block:: default

    moabb_plt.summary_plot(P, T)
    plt.show()



.. image:: /auto_examples/advanced_examples/images/sphx_glr_plot_statistical_analysis_004.png
    :alt: Algorithm comparison
    :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 1 minutes  1.013 seconds)


.. _sphx_glr_download_auto_examples_advanced_examples_plot_statistical_analysis.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_statistical_analysis.py <plot_statistical_analysis.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_statistical_analysis.ipynb <plot_statistical_analysis.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
