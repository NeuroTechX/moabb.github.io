
.. DO NOT EDIT.
.. THIS FILE WAS AUTOMATICALLY GENERATED BY SPHINX-GALLERY.
.. TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
.. "auto_examples/plot_within_session_ssvep.py"
.. LINE NUMBERS ARE GIVEN BELOW.

.. only:: html

    .. note::
        :class: sphx-glr-download-link-note

        Click :ref:`here <sphx_glr_download_auto_examples_plot_within_session_ssvep.py>`
        to download the full example code

.. rst-class:: sphx-glr-example-title

.. _sphx_glr_auto_examples_plot_within_session_ssvep.py:


===================
Within Session SSVEP
===================

This Example show how to perform a within-session SSVEP analysis on the
MAMEM dataset 3, using a CCA pipeline.

The within-session evaluation assesses the performance of a classification
pipeline using a 5-fold cross-validation. The reported metric (here, accuracy)
is the average of all fold.

.. GENERATED FROM PYTHON SOURCE LINES 13-34

.. code-block:: default

    # Authors: Sylvain Chevallier <sylvain.chevallier@uvsq.fr>
    #
    # License: BSD (3-clause)

    import warnings

    import matplotlib.pyplot as plt
    import seaborn as sns
    from sklearn.pipeline import make_pipeline

    import moabb
    from moabb.datasets import MAMEM3
    from moabb.evaluations import WithinSessionEvaluation
    from moabb.paradigms import SSVEP
    from moabb.pipelines import SSVEP_CCA


    warnings.simplefilter(action="ignore", category=FutureWarning)
    warnings.simplefilter(action="ignore", category=RuntimeWarning)
    moabb.set_log_level("info")





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1582: UserWarning: Trying to register the cmap 'rocket' which already exists.
      mpl_cm.register_cmap(_name, _cmap)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1583: UserWarning: Trying to register the cmap 'rocket_r' which already exists.
      mpl_cm.register_cmap(_name + "_r", _cmap_r)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1582: UserWarning: Trying to register the cmap 'mako' which already exists.
      mpl_cm.register_cmap(_name, _cmap)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1583: UserWarning: Trying to register the cmap 'mako_r' which already exists.
      mpl_cm.register_cmap(_name + "_r", _cmap_r)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1582: UserWarning: Trying to register the cmap 'icefire' which already exists.
      mpl_cm.register_cmap(_name, _cmap)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1583: UserWarning: Trying to register the cmap 'icefire_r' which already exists.
      mpl_cm.register_cmap(_name + "_r", _cmap_r)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1582: UserWarning: Trying to register the cmap 'vlag' which already exists.
      mpl_cm.register_cmap(_name, _cmap)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1583: UserWarning: Trying to register the cmap 'vlag_r' which already exists.
      mpl_cm.register_cmap(_name + "_r", _cmap_r)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1582: UserWarning: Trying to register the cmap 'flare' which already exists.
      mpl_cm.register_cmap(_name, _cmap)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1583: UserWarning: Trying to register the cmap 'flare_r' which already exists.
      mpl_cm.register_cmap(_name + "_r", _cmap_r)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1582: UserWarning: Trying to register the cmap 'crest' which already exists.
      mpl_cm.register_cmap(_name, _cmap)
    /home/runner/work/moabb/moabb/.venv/lib/python3.9/site-packages/seaborn/cm.py:1583: UserWarning: Trying to register the cmap 'crest_r' which already exists.
      mpl_cm.register_cmap(_name + "_r", _cmap_r)




.. GENERATED FROM PYTHON SOURCE LINES 35-39

Loading Dataset
---------------

Load 2 subjects of MAMEM3 dataset

.. GENERATED FROM PYTHON SOURCE LINES 39-44

.. code-block:: default


    subj = [1, 3]
    dataset = MAMEM3()
    dataset.subject_list = subj








.. GENERATED FROM PYTHON SOURCE LINES 45-51

Choose Paradigm
---------------

We select the paradigm SSVEP, applying a bandpass filter (3-15 Hz) on
the data and we keep only the first 3 classes, that is stimulation
frequency of 6.66, 7.50 and 8.57 Hz.

.. GENERATED FROM PYTHON SOURCE LINES 51-54

.. code-block:: default


    paradigm = SSVEP(fmin=3, fmax=15, n_classes=3)








.. GENERATED FROM PYTHON SOURCE LINES 55-59

Create Pipelines
----------------

Use a Canonical Correlation Analysis classifier

.. GENERATED FROM PYTHON SOURCE LINES 59-66

.. code-block:: default


    interval = dataset.interval
    freqs = paradigm.used_events(dataset)

    pipeline = {}
    pipeline["CCA"] = make_pipeline(SSVEP_CCA(interval=interval, freqs=freqs, n_harmonics=3))








.. GENERATED FROM PYTHON SOURCE LINES 67-77

Get Data (optional)
-------------------

To get access to the EEG signals downloaded from the dataset, you could
use `dataset.get_data(subjects=[subject_id])` to obtain the EEG under
MNE format, stored in a dictionary of sessions and runs.
Otherwise, `paradigm.get_data(dataset=dataset, subjects=[subject_id])`
allows to obtain the EEG data in scikit format, the labels and the meta
information. In `paradigm.get_data`, the EEG are preprocessed according
to the paradigm requirement.

.. GENERATED FROM PYTHON SOURCE LINES 77-81

.. code-block:: default


    # sessions = dataset.get_data(subjects=[3])
    # X, labels, meta = paradigm.get_data(dataset=dataset, subjects=[3])








.. GENERATED FROM PYTHON SOURCE LINES 82-87

Evaluation
----------

The evaluation will return a DataFrame containing a single AUC score for
each subject and pipeline.

.. GENERATED FROM PYTHON SOURCE LINES 87-97

.. code-block:: default


    overwrite = True  # set to True if we want to overwrite cached results

    evaluation = WithinSessionEvaluation(
        paradigm=paradigm, datasets=dataset, suffix="examples", overwrite=overwrite
    )
    results = evaluation.process(pipeline)

    print(results.head())





.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none

    SSVEP MAMEM3-WithinSession:   0%|          | 0/2 [00:00<?, ?it/s]    SSVEP MAMEM3-WithinSession:  50%|#####     | 1/2 [00:18<00:18, 18.46s/it]    SSVEP MAMEM3-WithinSession: 100%|##########| 2/2 [00:37<00:00, 18.58s/it]    SSVEP MAMEM3-WithinSession: 100%|##########| 2/2 [00:37<00:00, 18.56s/it]
          score      time  samples  ... n_sessions       dataset  pipeline
    0  0.688889  0.057410     45.0  ...          1  SSVEP MAMEM3       CCA
    1  0.266667  0.056557     45.0  ...          1  SSVEP MAMEM3       CCA

    [2 rows x 9 columns]




.. GENERATED FROM PYTHON SOURCE LINES 98-102

Plot Results
----------------

Here we plot the results, indicating the score for each subject

.. GENERATED FROM PYTHON SOURCE LINES 102-106

.. code-block:: default


    plt.figure()
    sns.barplot(data=results, y="score", x="session", hue="subject", palette="viridis")




.. image:: /auto_examples/images/sphx_glr_plot_within_session_ssvep_001.png
    :alt: plot within session ssvep
    :class: sphx-glr-single-img


.. rst-class:: sphx-glr-script-out

 Out:

 .. code-block:: none


    <AxesSubplot:xlabel='session', ylabel='score'>



.. GENERATED FROM PYTHON SOURCE LINES 107-108

And the computation time in seconds

.. GENERATED FROM PYTHON SOURCE LINES 108-113

.. code-block:: default


    plt.figure()
    ax = sns.barplot(data=results, y="time", x="session", hue="subject", palette="Reds")
    ax.set_ylabel("Time (s)")
    plt.show()



.. image:: /auto_examples/images/sphx_glr_plot_within_session_ssvep_002.png
    :alt: plot within session ssvep
    :class: sphx-glr-single-img






.. rst-class:: sphx-glr-timing

   **Total running time of the script:** ( 0 minutes  37.352 seconds)


.. _sphx_glr_download_auto_examples_plot_within_session_ssvep.py:


.. only :: html

 .. container:: sphx-glr-footer
    :class: sphx-glr-footer-example



  .. container:: sphx-glr-download sphx-glr-download-python

     :download:`Download Python source code: plot_within_session_ssvep.py <plot_within_session_ssvep.py>`



  .. container:: sphx-glr-download sphx-glr-download-jupyter

     :download:`Download Jupyter notebook: plot_within_session_ssvep.ipynb <plot_within_session_ssvep.ipynb>`


.. only:: html

 .. rst-class:: sphx-glr-signature

    `Gallery generated by Sphinx-Gallery <https://sphinx-gallery.github.io>`_
